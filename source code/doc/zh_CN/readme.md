
# 内容优先朗读NVDA插件

让纯文本内容在控件信息之前朗读，以享受更好的操作体验。

## 下载

* 你可以
[点击这里下载最新版本](https://github.com/c469591/ContentPriorityReading/raw/main/content_priority_reading%20V0.3.nvda-addon)
的NVDA插件。
* 你还可以前往我的github仓库页面
[点我前往内容优先朗读的github仓库页面](https://github.com/c469591/ContentPriorityReading)

### 兼容性

NVDA2024.1以上版本测试正常

## 功能特色

* 智能语音重排：自动将文本内容排在控件类型信息之前
* 多语言支持：纯API实现，支持所有NVDA支持的语言
* 实时切换：一键开启/关闭功能
* 调试模式：开发者友好的详细日志输出
* 诊断工具：内建多种诊断和测试功能

## 快捷键

### 预设快捷键

* NVDA+Ctrl+Shift+Y：切换内容优先朗读功能开关

### 可自定义快捷键的功能

以下功能可通过 NVDA 的「输入手势」对话框自定义快捷键：

* 切换调试模式：查看详细的语音序列处理信息
* 测试重排功能：演示语音重排效果
* 显示插件状态：查看当前设定和最后处理的序列

## 使用方法

### 基本使用

1. 按 `NVDA+Ctrl+Shift+Y` 开启功能
1. 在网页或应用程序中正常浏览
1. 注意听取语音顺序的变化：内容会优先于控件类型被朗读

### 示例效果

开启前：「按钮 确定」
开启后：「确定 按钮」

开启前：「链接 首页」
开启后：「首页 链接」

你还可以打开这个测试页面，启动内容优先朗读来测试效果
[点我打开测试页面](https://twapi.lambgui.com/lamb_gui/html/test_speech.html)

## 故障排除

### 当发现没有按照预期改变顺序时

如果你发现某些情况下插件没有正常工作，可以按照以下步骤收集诊断信息：

#### 1. 开启调试模式

1. 打开NVDA菜单 → 选项 → 设置 → 事件记录等级下拉框中选择调试，
之后tab找确定enter
1. 打开NVDA菜单 → 选项 → 输入手势
1. 在「内容优先朗读」分类下找到「切换调试模式」
1. 为其设定一个快捷键（例如：NVDA+Ctrl+Shift+D）
1. 按下设定的快捷键开启调试模式
1. 确认听到「调试模式已开启」的提示

#### 2. 重现问题操作

1. 按照平常的方式浏览网页或使用软件
1. 尝试在有问题的页面或控件上重现语音顺序问题
1. 多测试几个不同的控件类型（按钮、链接、文本框等）

#### 3. 复制日志信息

1. 打开NVDA菜单 → 工具 → 查看事件记录
1. 在日志窗口中按 `Ctrl+A` 全选所有内容
1. 按 `Ctrl+C` 复制日志内容
1. 将复制的日志内容粘贴到文本文件或电子邮件中发给我，电子邮件→
c469591@mail.batol.net

#### 4. 关闭调试模式并联系开发者

完成问题重现后，记得按同样的快捷键关闭调试模式，避免产生过多日志信息。


## 更新日志

### V0.3

1. 使用官方 filter_speechSequence API 重构，提升与其他插件的兼容性
2. 使用 PropertyTextCommand 精确标记控件类型和状态，彻底解决纯文字误判问题
3. 扩展重排范围：不仅控件类型（链接、按钮等），状态（选中、按下等）也会移到最后朗读
4. 新增配置保存功能，重启 NVDA 后自动记忆开关状态
5. 新增多语言支持：繁体中文、简体中文、英文
6. 尊重用户设定：不会朗读用户设定中已关闭的属性

### V0.21

1. 使用精确匹配控件避免错误排序
2. 新增了一个测试用的html文件

### v0.2

* 修复跟其他需要捕获朗读内容的插件冲突的问题
